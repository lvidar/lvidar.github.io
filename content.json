{"pages":[{"title":"About Me","text":"一名大三信安学生，CTFer，Web专攻，Crypto业余爱好。 同时也是一名决斗者，DL的攻略向文章也会写不少进行总结，一飞冲天啊，我！ Awards湖南省第三届网络安全技能赛二等奖 现在正在为铁三和第四届努力~","link":"/about/index.html"},{"title":"categories","text":"","link":"/categories/index.html"}],"posts":[{"title":"BUU Web WP 合集","text":"大三了，虽说是准备考研，但还是想能在大三上再进一步，参加更多的比赛，与更多的人在安全方面一较高下。 这篇是 BUU 刷题合集，与其中知识点相关联的文章也会写不少，正处于连载状态，如果您有更好的想法或者我的文章有些许纰漏，请您在下方评论区留言，我会尽快回复，十分感谢。 HCTF 2018 WarmUp 每天努力加更中…","link":"/2020/09/21/2020-09-21-01/"},{"title":"HCTF 2018 WarmUp","text":"打开是一张图片，查看源码有提示： 12345&lt;body&gt; &lt;!--source.php--&gt; &lt;br&gt; &lt;img src=&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg&quot; /&gt;&lt;/body&gt; 首先先了解两个 php 函数，方便下面的理解： mb_strpos (PHP 4 &gt;= 4.0.6, PHP 5, PHP 7) mb_strpos — 查找字符串在另一个字符串中首次出现的位置 1mb_strpos ( string $haystack , string $needle [, int $offset = 0 [, string $encoding = mb_internal_encoding() ]] ) : int 例如题中有： 1mb_strpos($page . &apos;?&apos;, &apos;?&apos;) 即为 page 的值拼接 ‘?’ 作为被查找的字符串，’?’ 则为需要查找的字符串。 可以看出，若 page 中无 ‘?’ ，那么这个函数的返回值将是 page 的长度。 mb_substr (PHP 4 &gt;= 4.0.6, PHP 5, PHP 7) mb_substr — 获取部分字符串 1mb_substr ( string $str , int $start [, int $length = NULL [, string $encoding = mb_internal_encoding() ]] ) : string 例如题中有： 12345mb_substr( $page, 0, mb_strpos($page . &apos;?&apos;, &apos;?&apos;) ); 即为从 page 这个字符串的第一个字符开始，截取 mb_strpos($page . ‘?’, ‘?’) 这个函数的返回值长度的字符串，也就是说如果值是 2 ，那么结果就是 page 的前两个字符。 综上，就是在截取 page 中 ‘?’ 之前的部分字符串。 回到正题，我们打开 source.php ，发现有 php 源码： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162&lt;?php highlight_file(__FILE__); //定义了一个类 类名 emmm class emmm { //静态公共方法，不需要实例化类 public static function checkFile(&amp;$page) { //白名单键值对数组 $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;]; //限制条件1：page 需要设置并且为字符串类型 if (! isset($page) || !is_string($page)) { echo &quot;you can&apos;t see it&quot;; return false; } //限制条件2：page 的值需要在白名单内 if (in_array($page, $whitelist)) { return true; } //限制条件3： //截取子字符串 $_page = mb_substr( $page, 0, mb_strpos($page . &apos;?&apos;, &apos;?&apos;) ); //这个子字符串也需要在白名单当中 if (in_array($_page, $whitelist)) { return true; } //限制条件4： //进行了 url 解码 $_page = urldecode($page); //同限制条件3，解码后结果截取后的子字符串也需要在白名单当中 $_page = mb_substr( $_page, 0, mb_strpos($_page . &apos;?&apos;, &apos;?&apos;) ); if (in_array($_page, $whitelist)) { return true; } echo &quot;you can&apos;t see it&quot;; return false; } } //需要我们传入 file 参数，file 必须返回为 true if (! empty($_REQUEST[&apos;file&apos;]) &amp;&amp; is_string($_REQUEST[&apos;file&apos;]) &amp;&amp; emmm::checkFile($_REQUEST[&apos;file&apos;]) ) { //文件包含，这里就是要去 getflag 的关键点 include $_REQUEST[&apos;file&apos;]; exit; } else { echo &quot;&lt;br&gt;&lt;img src=\\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&quot; /&gt;&quot;; } ?&gt; 而其中提到了 hint.php ，打开有如下提示： 1flag not here, and flag in ffffllllaaaagggg 通篇梳理一下： 我们需要传入一个 string 参数 file ，file 的值通过 checkFile 方法进行检验，而 file 必须带有 ffffllllaaaagggg 字样以供我们通过文件包含获取 flag ，在方法的 4 个限制条件中，可以看到，第 2 个我们是绝对不可能满足的，所以，我们需要绕过第 3 或者 第 4 个条件来达到 return true 的目的。 进行一下构造： 1?file=source.php?../ffffllllaaaagggg 条件 3 或 4 只不过是要求 ‘?’ 前必须在白名单中，这里我们自行添加 ‘?’ 即可绕过，而文件包含的是 ‘?’ 后的文件。 这里我们并不知道 ffffllllaaaagggg 的路径，可以利用目录穿越读取。 最后的 payload ： 1?file=source.php?../../../../../ffffllllaaaagggg","link":"/2020/09/21/2020-09-21-02/"}],"tags":[{"name":"BUU","slug":"BUU","link":"/tags/BUU/"},{"name":"PHP","slug":"PHP","link":"/tags/PHP/"},{"name":"代码审计","slug":"代码审计","link":"/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}],"categories":[{"name":"安全","slug":"安全","link":"/categories/%E5%AE%89%E5%85%A8/"}]}